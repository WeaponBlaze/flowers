<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flower Bouquet â€” Animated</title>
  <style>
    :root{
      --bg:#f7fbff;
      --stem:#2f7a3a;
      --ribbon:#d33f81;
      --petal1:#ff6fa3;
      --petal2:#ffd36f;
      --petal3:#8ec5ff;
      --center:#ffd27a;
      --shadow: rgba(20,20,30,0.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      background: radial-gradient(1200px 600px at 10% 10%, #ffffff 0%, var(--bg) 30%), var(--bg);
      display:flex; align-items:center; justify-content:center; padding:32px;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    .stage{max-width:980px; width:100%; display:flex; gap:24px; align-items:center; justify-content:center; flex-direction:column}

    .card{background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.85));
          border-radius:20px; padding:28px; box-shadow:0 10px 30px var(--shadow); width:100%; max-width:760px}

    .title{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px}
    h1{font-size:20px; margin:0; color:#1a2b3a}
    p{margin:0; color:#4b5b6b}

    .scene{display:flex; align-items:flex-end; gap:24px; justify-content:center; padding:18px 0}

    /* bouquet container */
    .bouquet{position:relative; width:360px; height:420px; display:block; transform-origin:center bottom;}
    .bouquet.sway{animation:bouquet-sway 6s ease-in-out infinite}

    @keyframes bouquet-sway{
      0%{transform: rotate(-1deg)}
      50%{transform: rotate(1.2deg)}
      100%{transform: rotate(-1deg)}
    }

    /* stems */
    .stem{position:absolute; left:50%; bottom:32px; width:14px; height:260px; background:linear-gradient(180deg,#4aa55a,var(--stem)); transform-origin:center bottom; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.06);}
    .stem:before{content:''; position:absolute; left:50%; top:-18px; transform:translateX(-50%); width:30px; height:30px; background:radial-gradient(circle at 30% 30%, rgba(255,255,255,0.6), transparent 30%); border-radius:50%}

    /* ribbon */
    .ribbon{position:absolute; left:50%; bottom:36px; transform:translateX(-50%); width:160px; height:36px; background:linear-gradient(90deg,var(--ribbon), #b1326a); border-radius:18px; box-shadow:0 6px 12px rgba(0,0,0,0.08); display:flex; align-items:center; justify-content:center; color:white; font-weight:600}
    .ribbon:after{content:''; position:absolute; left:-18px; bottom:-18px; width:36px; height:36px; background:linear-gradient(45deg, rgba(0,0,0,0.06), transparent); transform:rotate(-20deg); border-radius:6px}

    /* flowers: petals + center */
    .flower{position:absolute; width:120px; height:120px; transform-origin:center center; display:block}
    .flower .center{position:absolute; left:50%; top:50%; width:28px; height:28px; background:var(--center); border-radius:50%; transform:translate(-50%,-50%); box-shadow:0 6px 12px rgba(0,0,0,0.08); z-index:5}
    .petal{position:absolute; left:50%; top:50%; width:58px; height:48px; background:var(--petal1); border-radius:48% 48% 46% 46%; transform-origin:8% 60%; transform: translate(-50%,-50%) rotate(0deg) scale(0.9); box-shadow:0 6px 18px rgba(0,0,0,0.06);}
    .petal.p2{background:var(--petal2)}
    .petal.p3{background:var(--petal3)}

    /* place petals around center */
    .petal.p1{transform: translate(-50%,-50%) rotate(0deg)}
    .petal.p2{transform: translate(-50%,-50%) rotate(72deg)}
    .petal.p3{transform: translate(-50%,-50%) rotate(144deg)}
    .petal.p4{transform: translate(-50%,-50%) rotate(216deg)}
    .petal.p5{transform: translate(-50%,-50%) rotate(288deg)}

    /* bloom animation */
    .flower.bloom{animation:bloom 1s cubic-bezier(.2,.9,.3,1) forwards}
    .flower .petal{transform: translate(-50%,-50%) scale(0)}
    .flower.bloom .petal{animation:petal-pop 650ms cubic-bezier(.2,.9,.3,1) forwards}
    .flower.bloom .petal:nth-child(1){animation-delay:70ms}
    .flower.bloom .petal:nth-child(2){animation-delay:120ms}
    .flower.bloom .petal:nth-child(3){animation-delay:170ms}
    .flower.bloom .petal:nth-child(4){animation-delay:210ms}
    .flower.bloom .petal:nth-child(5){animation-delay:260ms}

    @keyframes petal-pop{0%{transform:translate(-50%,-50%) scale(0)} 80%{transform:translate(-50%,-50%) scale(1.05)} 100%{transform:translate(-50%,-50%) scale(1)}}
    @keyframes bloom{0%{transform:scale(0.3); opacity:0}100%{transform:scale(1); opacity:1}}

    /* place multiple flowers to make a bouquet */
    .f1{left:44%; bottom:210px; transform:translateX(-50%)}
    .f2{left:34%; bottom:170px; transform:translateX(-50%) scale(0.92)}
    .f3{left:56%; bottom:170px; transform:translateX(-50%) scale(0.92)}
    .f4{left:48%; bottom:140px; transform:translateX(-50%) scale(0.78)}

    /* small leaf accents */
    .leaf{position:absolute; width:40px; height:18px; background:linear-gradient(90deg,#5db46a,#3f7b47); border-radius:10px; transform-origin:left center; box-shadow:0 6px 8px rgba(0,0,0,0.06)}
    .leaf.l1{left:42%; bottom:300px; transform:rotate(-30deg)}
    .leaf.l2{left:58%; bottom:300px; transform:rotate(18deg)}

    /* falling petals (optimized for mobile): use GPU-friendly transforms, animate via keyframes */
    .petal-fall{position:fixed; pointer-events:none; z-index:9999; width:18px; height:14px; opacity:0.95; border-radius:50% 40% 60% 50% / 60% 60% 40% 40%; filter:drop-shadow(0 4px 8px rgba(10,10,10,0.08)); will-change: transform, opacity; transform: translate3d(0,0,0);}

    .petal-fall.falling{animation: fall var(--dur, 3.2s) linear forwards}

    @keyframes fall{
      0%{transform: translate3d(0,0,0) rotate(0deg); opacity:1}
      100%{transform: translate3d(var(--dx, 0px), var(--dy, 110vh), 0) rotate(var(--rot, 180deg)); opacity:0.18}
    }

    /* controls */
    .controls{display:flex; gap:8px; align-items:center}
    .btn{background:#fff; border:1px solid #e6e9ee; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600; color:#233; box-shadow:0 6px 12px rgba(20,20,30,0.03)}
    .btn:active{transform:translateY(1px)}

    /* reduce motion preference */
    @media (prefers-reduced-motion: reduce){
      .bouquet.sway, .flower.bloom, .petal-fall, .flower .petal{animation:none !important; transition:none !important}
    }
  </style>
</head>
<body>
  <div class="stage">
    <div class="card">
      <div class="title">
        <div>
          <h1>Flower Bouquet</h1>
          <p>Decorative bouquet with CSS flowers and animated petals</p>
        </div>
        <div class="controls">
          <button class="btn" id="btn-petals">Shower Petals</button>
          <button class="btn" id="btn-color">Change Colors</button>
        </div>
      </div>

      <div class="scene">
        <div class="bouquet" id="bouquet">
          <div class="stem" style="left:50%;"></div>
          <div class="ribbon">Bouquet</div>

          <div class="leaf l1"></div>
          <div class="leaf l2"></div>

          <div class="flower f1" id="flower1">
            <div class="petal p1"></div>
            <div class="petal p2"></div>
            <div class="petal p3"></div>
            <div class="petal p4"></div>
            <div class="petal p5"></div>
            <div class="center"></div>
          </div>

          <div class="flower f2" id="flower2">
            <div class="petal p1"></div>
            <div class="petal p2"></div>
            <div class="petal p3"></div>
            <div class="petal p4"></div>
            <div class="petal p5"></div>
            <div class="center"></div>
          </div>

          <div class="flower f3" id="flower3">
            <div class="petal p1"></div>
            <div class="petal p2"></div>
            <div class="petal p3"></div>
            <div class="petal p4"></div>
            <div class="petal p5"></div>
            <div class="center"></div>
          </div>

          <div class="flower f4" id="flower4">
            <div class="petal p1"></div>
            <div class="petal p2"></div>
            <div class="petal p3"></div>
            <div class="petal p4"></div>
            <div class="petal p5"></div>
            <div class="center"></div>
          </div>

        </div>
      </div>
    </div>
    <p style="font-size:12px;color:#6b7b8b;margin-top:8px">Tip: click "Shower Petals" for an animated confetti of petals.</p>
  </div>

  <script>
    (function(){
      const bouquet = document.getElementById('bouquet');
      const flowers = [document.getElementById('flower1'), document.getElementById('flower2'), document.getElementById('flower3'), document.getElementById('flower4')];
      const btnPetals = document.getElementById('btn-petals');
      const btnColor = document.getElementById('btn-color');

      // start subtle sway
      bouquet.classList.add('sway');

      // staggered bloom on load
      function bloomAll(){
        flowers.forEach((f,i)=>{
          setTimeout(()=> f.classList.add('bloom'), i*220);
        });
      }
      bloomAll();

      // color palettes
      const palettes = [
        ['#ff6fa3','#ffd36f','#8ec5ff','#ffd27a'],
        ['#f36ea8','#ffe082','#b3e88b','#ffd27a'],
        ['#ff9aa2','#ffb7b2','#b6e3ff','#ffe39a']
      ];
      let palIdx = 0;

      btnColor.addEventListener('click', ()=>{
        palIdx = (palIdx+1) % palettes.length;
        const p = palettes[palIdx];
        document.documentElement.style.setProperty('--petal1', p[0]);
        document.documentElement.style.setProperty('--petal2', p[1]);
        document.documentElement.style.setProperty('--petal3', p[2]);
        document.documentElement.style.setProperty('--center', p[3]);
      });

      // Performance-optimized petals: pooling + CSS keyframe animations + mobile limits
      const isMobile = window.matchMedia('(hover: none) and (pointer: coarse)').matches || window.innerWidth < 700;
      const MAX_PETALS = isMobile ? 10 : 40;
      const pool = [];
      const available = [];

      function initPool(){
        for(let i=0;i<MAX_PETALS;i++){
          const el = document.createElement('div');
          el.className = 'petal-fall';
          el.style.display = 'none';
          document.body.appendChild(el);
          pool.push(el);
          available.push(el);
        }
      }
      initPool();

      function createPetal(x, y, color){
        if(available.length === 0) return; // all petals busy
        const el = available.pop();
        el.style.left = x + 'px';
        el.style.top = y + 'px';
        el.style.background = color;
        const dx = ((Math.random()-0.5)*160).toFixed(0) + 'px';
        const rot = (Math.random()*540 - 180).toFixed(0) + 'deg';
        const base = isMobile ? 1800 : 3000;
        const dur = (base + Math.random()*1200).toFixed(0) + 'ms';
        const dy = '110vh';
        el.style.setProperty('--dx', dx);
        el.style.setProperty('--rot', rot);
        el.style.setProperty('--dur', dur);
        el.style.setProperty('--dy', dy);
        el.style.opacity = '1';
        el.style.display = 'block';

        // trigger animation
        el.classList.remove('falling');
        // force reflow to restart animation
        void el.offsetWidth;
        el.classList.add('falling');

        // when animation ends, hide and return to available pool
        function done(){
          el.style.display = 'none';
          el.classList.remove('falling');
          available.push(el);
        }
        el.addEventListener('animationend', done, {once:true});
      }

      function shower(n){
        const rect = bouquet.getBoundingClientRect();
        const colors = [getComputedStyle(document.documentElement).getPropertyValue('--petal1').trim(), getComputedStyle(document.documentElement).getPropertyValue('--petal2').trim(), getComputedStyle(document.documentElement).getPropertyValue('--petal3').trim()];
        const limit = Math.min(n, pool.length * 2);
        for(let i=0;i<limit;i++){
          const x = rect.left + Math.random()*rect.width;
          const y = rect.top + Math.random()*rect.height*0.6;
          const c = colors[Math.floor(Math.random()*colors.length)] || '#ff9aa2';
          // stagger launches but keep low on mobile
          const delay = isMobile ? i*60 : i*80;
          setTimeout(()=> createPetal(x,y,c), delay);
        }
      }

      btnPetals.addEventListener('click', ()=>{
        // accessibility: don't create animation if user prefers reduced motion
        const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        if(prefersReduced) return alert('Reduced motion is enabled in your OS settings.');
        const count = isMobile ? 14 : 28;
        shower(count);
      });

      // small helper: refresh bloom when user resizes or reopens
      window.addEventListener('visibilitychange', ()=>{ if(document.visibilityState === 'visible') bloomAll(); });

      // ensure pool resizes on orientation change (for some devices)
      window.addEventListener('resize', ()=>{
        // no-op: keep current pool for simplicity; future improvement: adapt pool size
      });

    })();
  </script>
</body>
</html>
